# Blog Post Discussions Automation

This directory contains automation for creating GitHub Discussions for blog posts.

## How It Works

### Workflow: `.github/workflows/create-discussions.yml`

This GitHub Actions workflow automatically creates a discussion for each blog post:

- **Triggers:**
  - When changes are pushed to the `master` branch in the `_posts/` directory
  - Manually via `workflow_dispatch`

- **Process:**
  1. Scans all markdown files in `_posts/`
  2. For each post without an existing discussion, creates a new one in the "General" category
  3. Updates `_data/discussions.yml` with the discussion URL and metadata
  4. Commits and pushes the updated data file back to the repository

### Script: `.github/scripts/create_discussions.py`

Python script that:
- Parses post front matter to extract title, date, and permalink
- Uses the GitHub CLI (`gh`) to interact with the GraphQL API
- Creates discussions with a link back to the original blog post
- Maintains a YAML mapping of post slugs to discussion URLs

### Template Integration: `_layouts/post.html`

The post layout has been modified to:
- Extract the post slug from the filename
- Check if a discussion exists in `_data/discussions.yml`
- Display "Join the discussion" link with GitHub icon if a discussion exists
- Fall back to the contact link if no discussion exists

## Data File: `_data/discussions.yml`

This file is automatically generated and maintained by the workflow. Format:

```yaml
post-slug:
  number: 123
  title: "Discussion: Post Title"
  url: https://github.com/joshspicer/joshspicer.github.io/discussions/123
```

**Note:** Do not manually edit this file - it will be overwritten by the workflow.

## Manual Trigger

To manually create discussions for all posts without one:

1. Go to Actions tab in GitHub
2. Select "Create Post Discussions" workflow
3. Click "Run workflow"
4. Select the `master` branch
5. Click "Run workflow"

## Requirements

- GitHub Discussions must be enabled on the repository
- The workflow requires `contents: write` and `discussions: write` permissions
- Python 3.x with PyYAML package
- GitHub CLI (`gh`) available in the runner environment
